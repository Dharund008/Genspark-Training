https://learn.microsoft.com/en-us/azure/container-registry/container-registry-get-started-azure-cli



/dev/fd/13:18: command not found: compdef
dharund@DharunDs-MacBook-Pro July17 % az acr create --resource-group genspark-dharun --name dharuncontainerregistry --sku Standard --role-assignment-mode 'rbac-abac' --dnl-scope TenantReuse  
Argument '--role-assignment-mode' is in preview and under development. Reference and support levels: https://aka.ms/CLI_refstatus
Argument '--dnl-scope' is in preview and under development. Reference and support levels: https://aka.ms/CLI_refstatus
Warning: You have successfully updated the registry authentication mode to enable RBAC Registry + ABAC Repository Permissions. ACR Tasks within the registry that do not have an assigned identity for source registry access will not have data plane access to the registry. To configure source registry data plane access for your existing Tasks, you must explicitly assign an Entra identity for accessing the source registry using the '--source-registry-auth-id' flag in 'az acr task update'. Please refer to https://aka.ms/acr/auth/abac for more details.
(SkuUpdateConflict) Cannot update the registry SKU due to reason: Registry has active replications in other regions. Please remove them before proceeding.. For more information on SKU tiers, please visit https://aka.ms/acr/tiers.
Code: SkuUpdateConflict
Message: Cannot update the registry SKU due to reason: Registry has active replications in other regions. Please remove them before proceeding.. For more information on SKU tiers, please visit https://aka.ms/acr/tiers.
dharund@DharunDs-MacBook-Pro July17 % az acr create --resource-group genspark-dharun --name dharuncr2 --sku Standard --role-assignment-mode 'rbac-abac' --dnl-scope TenantReuse
Argument '--role-assignment-mode' is in preview and under development. Reference and support levels: https://aka.ms/CLI_refstatus
Argument '--dnl-scope' is in preview and under development. Reference and support levels: https://aka.ms/CLI_refstatus
Warning: You have successfully updated the registry authentication mode to enable RBAC Registry + ABAC Repository Permissions. ACR Tasks within the registry that do not have an assigned identity for source registry access will not have data plane access to the registry. To configure source registry data plane access for your existing Tasks, you must explicitly assign an Entra identity for accessing the source registry using the '--source-registry-auth-id' flag in 'az acr task update'. Please refer to https://aka.ms/acr/auth/abac for more details.
{
  "adminUserEnabled": false,
  "anonymousPullEnabled": false,
  "autoGeneratedDomainNameLabelScope": "TenantReuse",
  "creationDate": "2025-07-17T05:20:22.127318+00:00",
  "dataEndpointEnabled": false,
  "dataEndpointHostNames": [],
  "encryption": {
    "keyVaultProperties": null,
    "status": "disabled"
  },
  "id": "/subscriptions/fff309a9-2887-407d-b64d-e074e3d92e5b/resourceGroups/genspark-dharun/providers/Microsoft.ContainerRegistry/registries/dharuncr2",
  "identity": null,
  "location": "eastus",
  "loginServer": "dharuncr2-fxdfb7enb6brgehx.azurecr.io",
  "metadataSearch": "Disabled",
  "name": "dharuncr2",
  "networkRuleBypassOptions": "AzureServices",
  "networkRuleSet": null,
  "policies": {
    "azureAdAuthenticationAsArmPolicy": {
      "status": "enabled"
    },
    "exportPolicy": {
      "status": "enabled"
    },
    "quarantinePolicy": {
      "status": "disabled"
    },
    "retentionPolicy": {
      "days": 7,
      "lastUpdatedTime": "2025-07-17T05:20:30.617518+00:00",
      "status": "disabled"
    },
    "softDeletePolicy": {
      "lastUpdatedTime": "2025-07-17T05:20:30.617558+00:00",
      "retentionDays": 7,
      "status": "disabled"
    },
    "trustPolicy": {
      "status": "disabled",
      "type": "Notary"
    }
  },
  "privateEndpointConnections": [],
  "provisioningState": "Succeeded",
  "publicNetworkAccess": "Enabled",
  "resourceGroup": "genspark-dharun",
  "roleAssignmentMode": "AbacRepositoryPermissions",
  "sku": {
    "name": "Standard",
    "tier": "Standard"
  },
  "status": null,
  "systemData": {
    "createdAt": "2025-07-17T05:20:22.127318+00:00",
    "createdBy": "dharund@presidio.com",
    "createdByType": "User",
    "lastModifiedAt": "2025-07-17T05:20:22.127318+00:00",
    "lastModifiedBy": "dharund@presidio.com",
    "lastModifiedByType": "User"
  },
  "tags": {},
  "type": "Microsoft.ContainerRegistry/registries",
  "zoneRedundancy": "Disabled"
}
dharund@DharunDs-MacBook-Pro July17 % az acr login --name dharuncr2
Login Succeeded
dharund@DharunDs-MacBook-Pro July17 % docker pull mcr.microsoft.com/hello-world
Using default tag: latest
latest: Pulling from hello-world
1b930d010525: Pull complete 
Digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a
Status: Downloaded newer image for mcr.microsoft.com/hello-world:latest
mcr.microsoft.com/hello-world:latest
dharund@DharunDs-MacBook-Pro July17 % az acr repository list --name dharuncr2 --output table
2025-07-17 05:25:30.438624 Error: authentication required, visit https://aka.ms/acr/authorization for more information. Correlation ID: a26af313-8a84-4090-a3fd-e1ca5bc9ed41.
dharund@DharunDs-MacBook-Pro July17 % docker tag mcr.microsoft.com/hello-world dharuncr2-abc123.azurecr.io/hello-world:v1
dharund@DharunDs-MacBook-Pro July17 % docker push dharuncr2-abc123.azurecr.io/hello-world:v1
The push refers to repository [dharuncr2-abc123.azurecr.io/hello-world]
1b930d010525: Waiting 
failed to do request: Head "https://dharuncr2-abc123.azurecr.io/v2/hello-world/blobs/sha256:fce289e99eb9bca977dae136fbe2a82b6b7d4c372474c9235adc1741675f587e": dialing dharuncr2-abc123.azurecr.io:443 container via direct connection because  has no HTTPS proxy: connecting to dharuncr2-abc123.azurecr.io:443: dial tcp: lookup dharuncr2-abc123.azurecr.io: no such host
dharund@DharunDs-MacBook-Pro July17 % docker tag mcr.microsoft.com/hello-world dharuncr2-fxdfb7enb6brgehx.azurecr.io/hello-world:v1

dharund@DharunDs-MacBook-Pro July17 % docker push dharuncr2-fxdfb7enb6brgehx.azurecr.io/hello-world:v1
The push refers to repository [dharuncr2-fxdfb7enb6brgehx.azurecr.io/hello-world]
1b930d010525: Waiting 
push access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed
dharund@DharunDs-MacBook-Pro July17 % az acr login --name dharuncr2

Login Succeeded
dharund@DharunDs-MacBook-Pro July17 % docker login dharuncr2-fxdfb7enb6brgehx.azurecr.io

Username: dharuncr2
Password: 
dharund@DharunDs-MacBook-Pro July17 % docker push dharuncr2-fxdfb7enb6brgehx.azurecr.io/hello-world:v1                             
The push refers to repository [dharuncr2-fxdfb7enb6brgehx.azurecr.io/hello-world]
1b930d010525: Waiting 
push access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed
dharund@DharunDs-MacBook-Pro July17 % az acr update --name dharuncr2 --admin-enabled ture
az acr update: 'ture' is not a valid value for '--admin-enabled'. Allowed values: true, false.
Did you mean 'true' ?

Examples from AI knowledge base:
az acr update --name MyRegistry --admin-enabled true
Enable the administrator user account for an Azure Container Registry.

https://docs.microsoft.com/en-US/cli/azure/acr#az_acr_update
Read more about the command in reference docs
dharund@DharunDs-MacBook-Pro July17 % az acr update --name dharuncr2 --admin-enabled true
{
  "adminUserEnabled": true,
  "anonymousPullEnabled": false,
  "autoGeneratedDomainNameLabelScope": "TenantReuse",
  "creationDate": "2025-07-17T05:20:22.127318+00:00",
  "dataEndpointEnabled": false,
  "dataEndpointHostNames": [],
  "encryption": {
    "keyVaultProperties": null,
    "status": "disabled"
  },
  "id": "/subscriptions/fff309a9-2887-407d-b64d-e074e3d92e5b/resourceGroups/genspark-dharun/providers/Microsoft.ContainerRegistry/registries/dharuncr2",
  "identity": null,
  "location": "eastus",
  "loginServer": "dharuncr2-fxdfb7enb6brgehx.azurecr.io",
  "metadataSearch": "Disabled",
  "name": "dharuncr2",
  "networkRuleBypassOptions": "AzureServices",
  "networkRuleSet": null,
  "policies": {
    "azureAdAuthenticationAsArmPolicy": {
      "status": "enabled"
    },
    "exportPolicy": {
      "status": "enabled"
    },
    "quarantinePolicy": {
      "status": "disabled"
    },
    "retentionPolicy": {
      "days": 7,
      "lastUpdatedTime": "2025-07-17T05:20:30.617518+00:00",
      "status": "disabled"
    },
    "softDeletePolicy": {
      "lastUpdatedTime": "2025-07-17T05:20:30.617558+00:00",
      "retentionDays": 7,
      "status": "disabled"
    },
    "trustPolicy": {
      "status": "disabled",
      "type": "Notary"
    }
  },
  "privateEndpointConnections": [],
  "provisioningState": "Succeeded",
  "publicNetworkAccess": "Enabled",
  "resourceGroup": "genspark-dharun",
  "roleAssignmentMode": "AbacRepositoryPermissions",
  "sku": {
    "name": "Standard",
    "tier": "Standard"
  },
  "status": null,
  "systemData": {
    "createdAt": "2025-07-17T05:20:22.127318+00:00",
    "createdBy": "dharund@presidio.com",
    "createdByType": "User",
    "lastModifiedAt": "2025-07-17T06:10:04.978996+00:00",
    "lastModifiedBy": "dharund@presidio.com",
    "lastModifiedByType": "User"
  },
  "tags": {},
  "type": "Microsoft.ContainerRegistry/registries",
  "zoneRedundancy": "Disabled"
}
dharund@DharunDs-MacBook-Pro July17 % az acr login --name dharuncr2                     

Login Succeeded
dharund@DharunDs-MacBook-Pro July17 % docker tag mcr.microsoft.com/hello-world dharuncr2-fxdfb7enb6brgehx.azurecr.io/hello-world:v1

dharund@DharunDs-MacBook-Pro July17 % docker push dharuncr2-fxdfb7enb6brgehx.azurecr.io/hello-world:v1
The push refers to repository [dharuncr2-fxdfb7enb6brgehx.azurecr.io/hello-world]
1b930d010525: Waiting 
push access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed
dharund@DharunDs-MacBook-Pro July17 % az acr credential show --name dharuncr2

{
  "passwords": [
    {
      "name": "password",
      "value": "55bKo3K3WaCs8T6zna908wGnZinHRAFJ683BQpgel7+ACRC4arxZ"
    },
    {
      "name": "password2",
      "value": "0A585EHXt5pcDNTR/CIfLKpbK36cEvsVAvUwzcoVAg+ACRCvAJuF"
    }
  ],
  "username": "dharuncr2"
}
dharund@DharunDs-MacBook-Pro July17 % docker login dharuncr2-fxdfb7enb6brgehx.azurecr.io -u dharuncr2 -p 55bKo3K3WaCs8T6zna908wGnZinHRAFJ683BQpgel7+ACRC4arxZ

WARNING! Using --password via the CLI is insecure. Use --password-stdin.
Login Succeeded
dharund@DharunDs-MacBook-Pro July17 % az acr repository list --name dharuncr2 --output table
2025-07-17 06:14:26.827122 Error: authentication required, visit https://aka.ms/acr/authorization for more information. Correlation ID: 30d31193-8da0-4e3a-8961-60046f671d0d.
dharund@DharunDs-MacBook-Pro July17 % docker push dharuncr2-fxdfb7enb6brgehx.azurecr.io/hello-world:v1

The push refers to repository [dharuncr2-fxdfb7enb6brgehx.azurecr.io/hello-world]
1b930d010525: Pushed 
v1: digest: sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a size: 524
dharund@DharunDs-MacBook-Pro July17 % az acr repository list --name dharuncr2 --output table

2025-07-17 06:17:10.351606 Error: authentication required, visit https://aka.ms/acr/authorization for more information. Correlation ID: 2a03be54-090a-453b-a371-b4dbae18ced0.
dharund@DharunDs-MacBook-Pro July17 % az login
A web browser has been opened at https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize. Please continue the login in the web browser. If no web browser is available or if the web browser fails to open, use device code flow with `az login --use-device-code`.

Retrieving tenants and subscriptions for the selection...
The following tenants don't contain accessible subscriptions. Use `az login --allow-no-subscriptions` to have tenant level access.
7f7268a4-7179-4a42-9837-40255b1c21e5 'Presidio Network Solutions'
6c4e0f67-00c8-475b-b1d4-cf723426db0b 'Pyramid Consulting, Inc.'

[Tenant and subscription selection]

No     Subscription name    Subscription ID                       Tenant
-----  -------------------  ------------------------------------  ----------------------------
[1] *  AppDev - Training    fff309a9-2887-407d-b64d-e074e3d92e5b  Presidio Networked Solutions

The default is marked with an *; the default tenant is 'Presidio Networked Solutions' and subscription is 'AppDev - Training' (fff309a9-2887-407d-b64d-e074e3d92e5b).

Select a subscription and tenant (Type a number or Enter for no changes): 1

Tenant: Presidio Networked Solutions
Subscription: AppDev - Training (fff309a9-2887-407d-b64d-e074e3d92e5b)

[Announcements]
With the new Azure CLI login experience, you can select the subscription you want to use more easily. Learn more about it and its configuration at https://go.microsoft.com/fwlink/?linkid=2271236

If you encounter any problem, please open an issue at https://aka.ms/azclibug

[Warning] The login output has been updated. Please be aware that it no longer displays the full list of available subscriptions by default.

dharund@DharunDs-MacBook-Pro July17 % az acr repository list --name dharuncr2 --output table

2025-07-17 06:19:01.143398 Error: authentication required, visit https://aka.ms/acr/authorization for more information. Correlation ID: ba425455-7312-424e-9174-8def7b61c864.
dharund@DharunDs-MacBook-Pro July17 % az acr repository list --name dharuncr2-fxdfb7enb6brgehx --output table

Registry name is dharuncr2. The following suffix '-fxdfb7enb6brgehx' is automatically omitted.
2025-07-17 06:30:24.229496 Error: authentication required, visit https://aka.ms/acr/authorization for more information. Correlation ID: 7f6a721b-ac32-4481-aae8-0fed3692833e.
dharund@DharunDs-MacBook-Pro July17 % az acr login --name dharuncr2

Login Succeeded
dharund@DharunDs-MacBook-Pro July17 % az acr repository list --name dharuncr2 --output table
2025-07-17 06:32:22.783554 Error: authentication required, visit https://aka.ms/acr/authorization for more information. Correlation ID: bcc28e1b-7708-42bf-8c2b-3bf882d61979.
dharund@DharunDs-MacBook-Pro July17 % az account show --output table

EnvironmentName    HomeTenantId                          IsDefault    Name               State    TenantDefaultDomain    TenantDisplayName             TenantId
-----------------  ------------------------------------  -----------  -----------------  -------  ---------------------  ----------------------------  ------------------------------------
AzureCloud         2a731c61-a2b2-4661-8409-5b861cf40d0c  True         AppDev - Training  Enabled  presidiorocks.com      Presidio Networked Solutions  2a731c61-a2b2-4661-8409-5b861cf40d0c
dharund@DharunDs-MacBook-Pro July17 % az ad signed-in-user show --output json

{
  "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users/$entity",
  "businessPhones": [],
  "displayName": "D, Dharun",
  "givenName": "Dharun",
  "id": "f4cbab7c-52bb-468c-80d3-a4a1aee9de6a",
  "jobTitle": "Intern",
  "mail": "dharund@presidio.com",
  "mobilePhone": null,
  "officeLocation": "Chennai, TN",
  "preferredLanguage": "en-US",
  "surname": "D",
  "userPrincipalName": "dharund_presidio.com#EXT#@demopresidio.onmicrosoft.com"
}
dharund@DharunDs-MacBook-Pro July17 % az role assignment create \
  --assignee $(az ad signed-in-user show --query objectId -o tsv) \
  --role "AcrPull" \
  --scope $(az acr show --name dharuncr2 --query id -o tsv)

argument --assignee: expected one argument

Examples from AI knowledge base:
az role assignment create --assignee 00000000-0000-0000-0000-000000000000 --role "Storage Account Key Operator Service Role" --scope $id
Create a new role assignment for a user, group, or service principal. (autogenerated)

az role assignment create --assignee sp_name --role a_role
Create role assignment for an assignee.

az aks show --name MyManagedCluster --resource-group MyResourceGroup
Show the details for a managed Kubernetes cluster

https://docs.microsoft.com/en-US/cli/azure/role/assignment#az_role_assignment_create
Read more about the command in reference docs
dharund@DharunDs-MacBook-Pro July17 % az role assignment create \
  --assignee f4cbab7c-52bb-468c-80d3-a4a1aee9de6a \
  --role "AcrPull" \
  --scope $(az acr show --name dharuncr2 --query id -o tsv)
{
  "condition": null,
  "conditionVersion": null,
  "createdBy": null,
  "createdOn": "2025-07-17T06:36:15.705980+00:00",
  "delegatedManagedIdentityResourceId": null,
  "description": null,
  "id": "/subscriptions/fff309a9-2887-407d-b64d-e074e3d92e5b/resourceGroups/genspark-dharun/providers/Microsoft.ContainerRegistry/registries/dharuncr2/providers/Microsoft.Authorization/roleAssignments/79882084-96d8-4b1b-9818-7d11ed280ba3",
  "name": "79882084-96d8-4b1b-9818-7d11ed280ba3",
  "principalId": "f4cbab7c-52bb-468c-80d3-a4a1aee9de6a",
  "principalType": "User",
  "resourceGroup": "genspark-dharun",
  "roleDefinitionId": "/subscriptions/fff309a9-2887-407d-b64d-e074e3d92e5b/providers/Microsoft.Authorization/roleDefinitions/7f951dda-4ed3-4680-a7ca-43fe172d538d",
  "scope": "/subscriptions/fff309a9-2887-407d-b64d-e074e3d92e5b/resourceGroups/genspark-dharun/providers/Microsoft.ContainerRegistry/registries/dharuncr2",
  "type": "Microsoft.Authorization/roleAssignments",
  "updatedBy": "f4cbab7c-52bb-468c-80d3-a4a1aee9de6a",
  "updatedOn": "2025-07-17T06:36:15.883977+00:00"
}
dharund@DharunDs-MacBook-Pro July17 % az acr repository list --name dharuncr2 --output table

2025-07-17 06:36:45.305715 Error: authentication required, visit https://aka.ms/acr/authorization for more information. Correlation ID: 35b4f368-8988-4e8f-a9ef-185b498ddbf6.
dharund@DharunDs-MacBook-Pro July17 % 